---

dist: focal

services:
  - docker

stages:
  - Static test

jobs:
  include:
    - stage: Build test
      language: minimal
      before_script:
        - LATEST_AZCOPY="$(curl -sSLo- https://api.github.com/repos/Azure/azure-storage-azcopy/releases | jq -r '.[0].tag_name' | sed 's/^v//g')"
        - test -n "$LATEST_AZCOPY"
        - export LATEST_AZCOPY
      script:
        - IN="$LATEST_AZCOPY"
        - tag=(`echo $IN | tr '.' ' '`) 
        - docker build --build-arg AZCOPY_VERSION="$LATEST_AZCOPY" -t docker-azcopy:${tag[0]}.${tag[1]} -t docker-azcopy:${tag[0]} .
